# Simple Python3 Lambda Function Logging

## Default Lambda Logging

We will start by creating a very simple function that generates a random number between 1 and 100 to highlight how default log information is emitted and stored. AWS Lambda functions can send log data to Cloudwatch Logs log group and log streams for each instance of your function.

You can build and run the function locally using the following commands.

```bash
cd simple_function
sam build --use-container
sam local invoke DefaultLoggingFunction
```

The function emits the following log entries.

**NOTE:** The ouput below is representative - your output will differ.

```bash
simple_function % sam local invoke DefaultLoggingFunctionInvoking index.handler (python3.9)
Skip pulling image and use local one: public.ecr.aws/sam/emulation-python3.9:rapid-1.53.0-x86_64.

Mounting /path/to/lambda-logging-primer/simple_function/.aws-sam/build/DefaultLoggingFunction as /var/task:ro,delegated inside runtime container
START RequestId: d1e4bf88-fcfb-41c6-a43c-c8dacbf9beab Version: $LATEST
END RequestId: d1e4bf88-fcfb-41c6-a43c-c8dacbf9beab
REPORT RequestId: d1e4bf88-fcfb-41c6-a43c-c8dacbf9beab  Init Duration: 0.13 ms  Duration: 233.83 ms     Billed Duration: 234 ms        Memory Size: 128 MB     Max Memory Used: 128 MB
null%                                                                                   
```

There are several lines of note. 

* **START** provides the request ID and the invoked function version 

* **END** provides the request ID

* **REPORT** provides more information about the function invocation, including the

    * **RequestId** – The unique request ID for the invocation.

    * **Duration** – The amount of time that your function's handler method spent processing the event.

    * **Billed Duration** – The amount of time billed for the invocation.

    * **Memory Size** – The amount of memory allocated to the function.

    * **Max Memory Used** – The amount of memory used by the function.

    * **Init Duration** – For cold starts, the amount of time it took the runtime to load the function and run code outside of the handler method.

    * **XRAY TraceId** – For traced requests, the AWS X-Ray trace ID.

    * **SegmentId** – For traced requests, the X-Ray segment ID.

    * **Sampled** – For traced requests, the sampling result.

Now that we know what is logged by a function execution by default, let's log data from our function.

## Logging Application Data

Writing data in a Lambda function to `stdout` or `stderr` will cause the information to be logged. In Python3, this is as simple as using the `print` method or as complex as using a a logging library like [logging](https://docs.python.org/3/library/logging.html).

Using the following commands, you can build and run the function locally.

```bash
sam local invoke UserDefinedLoggingFunction
```

The function emits the following log entries.

**NOTE:** The ouput below is representative - your output will differ.

```bash
Invoking index.handler (python3.9)
Skip pulling image and use local one: public.ecr.aws/sam/emulation-python3.9:rapid-1.53.0-x86_64.

Mounting /Users/brian/code/mcnamarabrian/lambda-logging-primer/simple_function/.aws-sam/build/UserDefinedLoggingFunction as /var/task:ro,delegated inside runtime container
START RequestId: 5c90f47a-450b-4482-8199-f6da128a08d4 Version: $LATEST
[INFO]  2022-08-05T12:16:08.728Z        5c90f47a-450b-4482-8199-f6da128a08d4    Generated random number 98
END RequestId: 5c90f47a-450b-4482-8199-f6da128a08d4
REPORT RequestId: 5c90f47a-450b-4482-8199-f6da128a08d4  Init Duration: 0.36 ms  Duration: 120.73 ms     Billed Duration: 121 ms        Memory Size: 128 MB     Max Memory Used: 128 MB
null%                       
```

The **START**, **END**, and **REPORT** lines are still emitted, but there is a new line present that is generated by the `logger` object in [simple_function/user_defined_logging/index.py](./simple_function/user_defined_logging/index.py).

# Implications

AWS Lambda makes it easy to capture application data. Developers can take advantage of existing tooling they may already employ and emit data into a durable log storage.

However, simply emitting data into logs does not make it as usable as it can be for understanding application behavior or troubleshooting when problems occur. Humans may be able to read a log line clearly, but searching for log entries becomes difficult. Fortunately, there are ways that we can improve the experience. Next we will [explore how developers can structure their log data](./deploy-structured.md) so it can be indexed, searched, and visualized using CloudWatch.
